<!DOCTYPE html>
<html>
  <head>
    <title>WebSocket Demo</title>
    <style>
      .serverResponse {
        padding: 10px;
        margin-top: 10px;
        border: 1px solid #ddd;
        background-color: #f9f9f9;
      }
    </style>
  </head>
  <body>
    <h1>WebSocket Test</h1>
    <div id="responses"></div>

    <script>
      const ports = [50007, 50077, 50777, 57777];
      const responsesDiv = document.getElementById("responses");

      function tryWebSocketConnection(portIndex, isSecure = false) {
        if (portIndex >= ports.length) {
          if (!isSecure) {
            tryWebSocketConnection(0, true); // Попробуйте wss после ws
          } else {
            console.log("Успешное соединение не удалось для всех портов.");
          }
          return;
        }

        const port = ports[portIndex];
        const protocol = isSecure ? "wss" : "ws";
        const socket = new WebSocket(`${protocol}://localhost:${port}`, "v1");

        socket.onopen = () => {
          const responseDiv = document.createElement("div");
          responseDiv.classList.add("serverResponse");
          responseDiv.textContent = `Соединение с портом ${port} (${protocol}) установлено. Отправка запроса...`;
          responsesDiv.appendChild(responseDiv);

          const message = { type: "requestMarketingID" };
          socket.send(JSON.stringify(message));
        };

        socket.onmessage = (event) => {
          const messageDiv = document.createElement("div");
          messageDiv.classList.add("serverResponse");
          messageDiv.textContent = `Ответ от порта ${port} (${protocol}): ${event.data}`;
          responsesDiv.appendChild(messageDiv);

          console.log("Успешное соединение с портом:", port);
        };

        socket.onerror = (error) => {
          const errorDiv = document.createElement("div");
          errorDiv.classList.add("serverResponse");
          errorDiv.textContent = `Ошибка соединения с портом ${port} (${protocol}): ${error.message}`;
          responsesDiv.appendChild(errorDiv);

          tryWebSocketConnection(portIndex + 1);
        };

        socket.onclose = () => {
          const closeDiv = document.createElement("div");
          closeDiv.classList.add("serverResponse");
          closeDiv.textContent = `Соединение с портом ${port} (${protocol}) закрыто.`;
          responsesDiv.appendChild(closeDiv);

          tryWebSocketConnection(portIndex + 1, isSecure);
        };
      }

      tryWebSocketConnection(0);
    </script>
  </body>
</html>
